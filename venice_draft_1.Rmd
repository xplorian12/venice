---
title: "Venice Market Report"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    self_contained: true
    toc: false
    theme: readable
    df_print: paged
    number_sections: false
output_file: index.html
---


```{css, echo=FALSE}
:root {
  --bg: #f7f8fb;
  --card: #ffffff;
  --ink: #0f172a;
  --muted: #6b7280;
  --accent: #2563eb;
}
html, body {
  background: var(--bg);
  color: var(--ink);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  font-size: 17.5px;
  line-height: 1.65;
}
.main-container, .container-fluid {
  max-width: 1100px;
  margin: 0 auto;
  padding-left: 16px;
  padding-right: 16px;
}
h1, h2, h3, h4 {
  font-weight: 700;
  letter-spacing: .2px;
  color: #0b1220;
}
h1 { font-size: 2.25rem; margin-top: 2.2rem; border-bottom: 2px solid #e5e7eb; padding-bottom: .3rem; }
h2 { font-size: 1.7rem;  margin-top: 1.8rem; }
h3 { font-size: 1.3rem;  margin-top: 1.2rem; color: #334155; }
p, li { font-size: 1.02rem; }
pre, code { font-size: .98rem; }

hr { border-top: 1px solid #e5e7eb; }

.figure, .plotly, .html-widget {
  background: var(--card);
  padding: 14px;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,.05);
}

table {
  width: 100% !important;
  background: var(--card);
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(0,0,0,.05);
}
table thead th {
  background: #f3f4f6;
  font-weight: 700;
  text-transform: none;
  border-bottom: 1px solid #e5e7eb;
}
table tbody tr:nth-child(even) { background: #fafafa; }
table th, table td {
  padding: 10px 12px !important;
  border-right: 1px solid #eef2f7;
}
table th:last-child, table td:last-child { border-right: none; }

.kable_table_wrap {
  max-height: 520px;
  overflow: auto;
  border-radius: 12px;
}

.caption {
  color: #6b7280;
  font-size: .95rem;
  margin-bottom: .3rem;
}

/* --- responsive two/three column helpers --- */
/* Make each column keep a reasonable minimum width; stack if too narrow */
.columns-2 {
  display: grid;
  grid-template-columns: repeat(2, minmax(520px, 1fr)); /* bump this to 520–560px */
  gap: 18px;
}
@media (max-width: 1100px) {
  .columns-2 { grid-template-columns: 1fr; } /* stack for readability */
}
.columns-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  align-items: stretch;
}

/* Keep figures/widgets filling their columns cleanly */
.columns-2 .figure, .columns-3 .figure,
.columns-2 .plotly, .columns-3 .plotly,
.columns-2 .html-widget, .columns-3 .html-widget {
  width: 100% !important;
  box-sizing: border-box;
  margin: 0;                 /* kill extra outer margins that cause squish */
}

/* Slightly larger bottom space under standalone figures */
.figure { margin-bottom: 18px; }
```


```{r global-theme, include=FALSE}
suppressPackageStartupMessages({
  library(ggplot2)
})

theme_clean <- function(base_family = "Arial") {
  theme_minimal(base_family = base_family) +
    theme(
      plot.title      = element_text(face = "bold", size = 14, margin = margin(b = 8)),
      plot.subtitle   = element_text(size = 11, margin = margin(b = 10)),
      plot.caption    = element_text(size = 9, colour = "grey40", margin = margin(t = 10)),
      axis.title      = element_text(size = 11),
      axis.text       = element_text(size = 10),
      legend.title    = element_text(size = 10, face = "bold"),
      legend.text     = element_text(size = 9),
      panel.grid.minor= element_blank(),
      panel.grid.major= element_line(colour = "#e5e7eb"),
      plot.background = element_rect(fill = NA, colour = NA),
      panel.background= element_rect(fill = "white", colour = NA)
    )
}

theme_set(theme_clean())
update_geom_defaults("line",  list(size = 0.9))
update_geom_defaults("point", list(size = 2.2))
```




```{r table-theme, include=FALSE}
suppressPackageStartupMessages({
  library(gt)
  library(dplyr)
  library(tibble)
  library(stringr)
})

pretty_names <- function(nms) {
  nms %>%
    gsub("_", " ", ., fixed = TRUE) %>%
    stringr::str_trim() %>%
    stringr::str_to_title()
}

nice_table <- function(x, caption = NULL) {
  df <- as_tibble(x, .name_repair = "minimal") %>%
    mutate(`No.` = row_number(), .before = 1)

  num_cols <- names(df)[sapply(df, is.numeric)]

  gt_tbl <- df |>
    gt() |>
    tab_header(title = md(if (is.null(caption)) "" else paste0("**", caption, "**"))) |>
    cols_label(.list = setNames(pretty_names(names(df)), names(df))) |>
    fmt_number(columns = all_of(setdiff(num_cols, "No.")), decimals = 0, use_seps = TRUE) |>
    opt_row_striping() |>
    tab_options(
      table.font.size = px(16),
      data_row.padding = px(10),
      table_body.hlines.color = "#e5e7eb",
      table.border.top.color = "#e5e7eb",
      table.border.bottom.color = "#e5e7eb",
      column_labels.border.bottom.color = "#e5e7eb",
      column_labels.font.weight = "bold"
    ) |>
    opt_table_font(
      font = list(
        google_font(name = "Inter"),
        default_fonts()
      )
    ) |>
    cols_width(everything() ~ px(140))

  gt_tbl
}

knit_print.data.frame <- function(x, ..., options = NULL) {
  knitr::asis_output(as.character(nice_table(x)))
}

knit_print.tbl_df <- knit_print.data.frame
```




```{r table-helper, include=FALSE}
show_table <- function(title, df) {
  # If it's a data frame / tibble, render with gt + title.
  if (inherits(df, c("data.frame", "tbl", "tbl_df"))) {
    return(nice_table(df, caption = title))
  }
  # Try to coerce to tibble; if that fails, just return the object (e.g., a plot)
  try_df <- try(suppressWarnings(tibble::as_tibble(df, .name_repair = "minimal")), silent = TRUE)
  if (!inherits(try_df, "try-error") && inherits(try_df, c("data.frame", "tbl", "tbl_df"))) {
    return(nice_table(try_df, caption = title))
  }
  # Not a table? return as-is (plots, htmlwidgets, etc.)
  df
}
```





```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo   = FALSE,
  warning= FALSE,
  message= FALSE
)

library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
library(readr)
library(leaflet)
library(leaflet.extras)
library(patchwork)
library(scales)
library(tools)
library(htmltools)
library(tidycensus)
census_api_key("9d5931816199a62a9bbf24d1fb859fe15fd9ba6c", install = FALSE)
```

```{r}
options(scipen = 999)

base_folder <- "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians"

read_safely <- function(path) {
  x <- try(readr::read_csv(path, show_col_types = FALSE), silent = TRUE)
  if (inherits(x, "try-error") || !("Date" %in% names(x))) {
    x <- readr::read_csv(path, skip = 3, show_col_types = FALSE)
  }
  x
}
clean_num <- function(v) as.numeric(gsub("[,$]", "", as.character(v)))

files <- list.files(base_folder, pattern = "\\.csv$", full.names = TRUE, recursive = TRUE)

all_list <- vector("list", length(files))
names(all_list) <- files

for (fp in files) {
  df <- read_safely(fp)
  if (!"Date" %in% names(df)) next
  df$Date <- lubridate::my(df$Date)

  lower_path <- tolower(fp)
  segment <- dplyr::case_when(
    grepl("(^|/|\\\\)condo(\\b|/|\\\\)", lower_path) | grepl("_condo\\.csv$", lower_path) ~ "condo",
    grepl("(^|/|\\\\)sfr(\\b|/|\\\\)",   lower_path) | grepl("_sfr\\.csv$",   lower_path) ~ "sfr",
    grepl("(^|/|\\\\)lease(\\b|/|\\\\)", lower_path) | grepl("lease",          lower_path) ~ "lease",
    grepl("(^|/|\\\\)income(\\b|/|\\\\)",lower_path) | grepl("_income\\.csv$", lower_path) ~ "multifamily",  # NEW
    TRUE ~ "other"
  )

  fname  <- tools::file_path_sans_ext(basename(fp)) |> tolower()
  metric <- fname
  metric <- gsub("_(condo|sfr|lease|income)$", "", metric)   # NEW: strip trailing _income
  metric <- gsub("^(condo|sfr|lease|income)_", "", metric)   # NEW: strip leading income_
  metric <- gsub("^domsfr$", "dom",        metric)
  metric <- gsub("^dom_condo$", "dom",     metric)
  metric <- gsub("^dom_income$", "dom",    metric)           # NEW: normalize dom_income -> dom
  metric <- gsub("psf$", "per_sqft",       metric)

  value_cols <- setdiff(names(df), "Date")
  if (!length(value_cols)) next
  df[value_cols] <- lapply(df[value_cols], clean_num)

  df_long <- df %>%
    tidyr::pivot_longer(all_of(value_cols), names_to = "Series", values_to = "Value") %>%
    dplyr::mutate(Segment = segment, Metric = metric) %>%
    dplyr::select(Segment, Metric, Series, Date, Value) %>%
    tidyr::drop_na(Date, Value)

  all_list[[fp]] <- df_long
}

all_medians <- dplyr::bind_rows(all_list)

# === Read individual point data (optional) ===
# Bounding box for Venice/MDR area
bbox <- list(lat_min = 33.90, lat_max = 34.05, lon_min = -118.55, lon_max = -118.35)

clip_bbox <- function(df, bb) {
  dplyr::filter(df,
    dplyr::between(latitude,  bb$lat_min, bb$lat_max),
    dplyr::between(longitude, bb$lon_min, bb$lon_max)
  )
}

# helpers
pick_col <- function(nms, candidates) { h <- intersect(candidates, nms); if (length(h)) h[1] else NA_character_ }

clean_points <- function(path, segment_label) {
  df <- readr::read_csv(path, show_col_types = FALSE)
  names(df) <- tolower(gsub("\\s+", "_", names(df)))

  lat_col <- pick_col(names(df), c("latitude","lat","y"))
  lon_col <- pick_col(names(df), c("longitude","long","lng","lon","x"))
  sp_col  <- pick_col(names(df), c("sp","sale_price","sold_price","price"))
  dom_col <- pick_col(names(df), c("dom","days_on_market","daysmarket"))
  if (is.na(lat_col) || is.na(lon_col)) stop(sprintf("Missing lat/lon in %s", path))

  tibble::tibble(
    latitude  = df[[lat_col]],
    longitude = df[[lon_col]],
    SP  = if (!is.na(sp_col))  as.numeric(gsub("[^0-9.]", "", as.character(df[[sp_col]]))) else NA_real_,
    DOM = if (!is.na(dom_col)) as.numeric(gsub("[^0-9.]", "", as.character(df[[dom_col]]))) else NA_real_
  ) |>
    clip_bbox(bbox) |>
    dplyr::mutate(
      price_range = cut(
        SP,
        breaks = c(0, 700000, 1000000, 1500000, Inf),
        labels = c("Under $700K", "$700K–$1M", "$1M–$1.5M", "Over $1.5M"),
        include.lowest = TRUE
      ),
      Segment = segment_label
    )
}

# Optional loaders (don’t error if not present)  -------------------------  # NEW
read_points_if <- function(path, seg) {
  if (file.exists(path)) tryCatch(clean_points(path, seg), error = function(e) tibble::tibble()) else tibble::tibble()
}

# If you have these files in the working dir, they’ll load; otherwise they’ll be empty tibble()
sales_condo <- read_points_if("lat_only_condo.csv", "Condo")
sales_sfr   <- read_points_if("lat_only_sfr.csv",   "SFR")
sales_income <- read_points_if("lat_only_income.csv", "Income")
# sales_multi <- read_points_if("lat_only_income.csv", "Multifamily")       # uncomment if you have a MF points file

# Combined, bbox-limited
sales_data <- dplyr::bind_rows(sales_condo, sales_sfr, sales_income)  # add sales_multi when available

```

<h3><strong>Purpose: Get a strong understanding of the market and find opportunities.</h3>

<h2>General Overview</h2>

```{r}
# === Flagship time series visual graph ===
combined_df <- all_medians %>%
  dplyr::filter(
    Metric == "median_sale",
    Series == "Venice",
    Segment %in% c("sfr", "condo", "multifamily")
  ) %>%
  dplyr::mutate(
    Type = dplyr::case_when(
      Segment == "sfr"         ~ "SFR",
      Segment == "condo"       ~ "Condo",
      Segment == "multifamily" ~ "Multifamily"
    ),
    Price = as.numeric(Value)
  ) %>%
  dplyr::select(Date, Price, Type) %>%
  dplyr::arrange(Type, Date)

# --- Plot 1: price levels (trend only) ---
p_level <- ggplot2::ggplot(combined_df, ggplot2::aes(Date, Price, color = Type)) +
  ggplot2::geom_smooth(
    method = "loess", se = FALSE,
    linetype = "solid", linewidth = 1.3
  ) +
  ggplot2::scale_y_continuous(
    labels = scales::comma,
    breaks = scales::pretty_breaks(10),
    limits = c(0, 3000000)
  ) +
  ggplot2::labs(
    title = "Median Sale Price — SFR vs Condo vs Multifamily (Venice)",
    x = NULL, y = "Sale Price (USD)"
  ) +
  ggplot2::guides(color = ggplot2::guide_legend(title = NULL)) +
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )

# --- Compute MoM % change ---
pct_df <- combined_df %>%
  dplyr::group_by(Type) %>%
  dplyr::arrange(Date, .by_group = TRUE) %>%
  dplyr::mutate(PctChange = Price / dplyr::lag(Price, 1) - 1) %>%
  dplyr::ungroup()

# --- Plot 2: MoM % change (trend only) ---
p_pct <- ggplot2::ggplot(pct_df, ggplot2::aes(Date, PctChange, color = Type)) +
  ggplot2::geom_smooth(
    method = "loess", se = FALSE,
    linetype = "solid", linewidth = 1.3
  ) +
  ggplot2::scale_y_continuous(
    labels = scales::percent_format(accuracy = 0.1),
    limits = c(-0.15, 0.15), breaks = seq(-0.15, 0.15, by = 0.05)
  ) +
  ggplot2::labs(
    title = "Median Sale Price — MoM % Change (SFR vs Condo vs Multifamily)",
    x = NULL, y = "Change"
  ) +
  ggplot2::guides(color = ggplot2::guide_legend(title = NULL)) +
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )

# --- Render as two separate graphs ---


```

<div class="columns-2">
<div>
```{r, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
p_level


```
</div><div>
```{r}
p_pct
```
</div></div>

<p>As can be observed from the graphs, all property types experienced a dip in value between 2022 - 2023. While multifamily and single family homes began 2025 with a strong rise, condos rose at a much lower rate..</p>



```{r condo_price_by_bedroom, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
# Median Sale Price by Bedroom — Condo, SFR, Multifamily
suppressWarnings({

  # --- helpers ---
  find_first <- function(cands) { p <- cands[file.exists(cands)]; if (length(p)) p[1] else NA_character_ }
  read_local <- function(p) {
    x <- try(readr::read_csv(p, show_col_types = FALSE), silent = TRUE)
    if (inherits(x, "try-error")) x <- readr::read_csv(p, skip = 3, show_col_types = FALSE)
    x
  }
  to_num <- function(x) as.numeric(gsub("[^0-9.]", "", as.character(x)))

  # normalize bedrooms to numeric (treat studio/loft/efficiency as 0)
  normalize_beds <- function(v) {
    if (is.numeric(v)) return(v)
    s <- tolower(trimws(as.character(v)))
    out <- suppressWarnings(as.numeric(stringr::str_extract(s, "\\d+")))
    zero_mask <- grepl("\\bstudio\\b|^st\\b|efficien|loft", s)
    out[is.na(out) & zero_mask] <- 0
    out
  }

  # generic builder for a file -> plot
  build_bed_plot <- function(candidates, title_text) {
    path <- find_first(candidates)
    if (is.na(path)) stop(sprintf("File not found for: %s", title_text))

    df <- read_local(path)
    names(df) <- tolower(gsub("\\s+", "_", names(df)))

    sp_col  <- intersect(c("sp","sale_price","sold_price","price","close_price","closeprice","list_price"), names(df))[1]
    bed_col <- intersect(c("br","beds","bedrooms","bedroom","bedroomstotal","bedrooms_total","beds_total"), names(df))[1]
    if (is.na(sp_col) | is.na(bed_col)) stop(sprintf("Missing price/bedroom column in %s", basename(path)))

    df$SP   <- to_num(df[[sp_col]])
    df$Beds <- normalize_beds(df[[bed_col]])

    clean <- df %>%
      dplyr::filter(!is.na(SP), dplyr::between(SP, 50000, 20000000), !is.na(Beds)) %>%
      dplyr::mutate(
        BedLabel = dplyr::case_when(
          Beds <= 0 ~ "Studio",
          Beds == 1 ~ "1BR",
          Beds == 2 ~ "2BR",
          Beds == 3 ~ "3BR",
          Beds == 4 ~ "4BR",
          Beds >= 5 ~ "5BR+",
          TRUE      ~ NA_character_
        ),
        BedLabel = factor(BedLabel, levels = c("Studio","1BR","2BR","3BR","4BR","5BR+"))
      ) %>%
      tidyr::drop_na(BedLabel)

    agg <- clean %>%
      dplyr::group_by(BedLabel) %>%
      dplyr::summarise(MedianPrice = stats::median(SP, na.rm = TRUE), n = dplyr::n(), .groups = "drop")

    ggplot2::ggplot(agg, ggplot2::aes(BedLabel, MedianPrice)) +
      ggplot2::geom_col() +
      ggplot2::scale_y_continuous(
        labels = scales::dollar_format(),
        breaks = scales::pretty_breaks(8),
        expand = ggplot2::expansion(mult = c(0, .06))
      ) +
      ggplot2::labs(
        title = title_text,
        x = NULL, y = "Median Price (USD)"
      )
  }

  # --- path candidates per asset class (Venice root first, then fallbacks) ---
  condo_cands  <- c("lat_only_condo.csv",
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/lat_only_condo.csv",
                    file.path("medians","lat_only_condo.csv"),
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians/lat_only_condo.csv")

  sfr_cands    <- c("lat_only_sfr.csv",
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/lat_only_sfr.csv",
                    file.path("medians","lat_only_sfr.csv"),
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians/lat_only_sfr.csv")

  income_cands <- c("lat_only_income.csv",
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/lat_only_income.csv",
                    file.path("medians","lat_only_income.csv"),
                    "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians/lat_only_income.csv")

  # --- build plots ---
  p_condo_bed_price  <- build_bed_plot(condo_cands,  "Median Condo Sale Price by Bedroom Count")
  p_sfr_bed_price    <- build_bed_plot(sfr_cands,    "Median SFR Sale Price by Bedroom Count")
  p_income_bed_price <- build_bed_plot(income_cands, "Median Multifamily Sale Price by Bedroom Count")

  
})

# --- print each individually (no patchwork) ---



```

<div class="columns-2">
<div>
```{r}
p_condo_bed_price

```
</div><div>
```{r}
p_sfr_bed_price
```
</div></div>


<p>The above charts show the median price for condos and single family homes by bedroom count. you may notice an almost $1,000,000 difference in value between 3 and 4 bedroom houses.</p>



<h2>Market Overview - Pricing & Analysis</h2>

```{r}
suppressWarnings({
  # --- ensure required globals exist ---
  if (!exists("SeriesName")) SeriesName <- "Venice"
  if (!exists("label_type")) {
    label_type <- function(seg) dplyr::case_when(
      tolower(seg) == "sfr"         ~ "SFR",
      tolower(seg) == "condo"       ~ "Condo",
      tolower(seg) == "multifamily" ~ "Multifamily",
      TRUE                          ~ seg
    )
  }

  # ---------- helpers ----------
  find_first <- function(cands) {
    p <- cands[file.exists(cands)]
    if (length(p)) p[1] else NA_character_
  }

  read_metric_csv <- function(path) {
    if (is.na(path)) stop("CSV path not found; update candidates.")
    x <- try(readr::read_csv(path, show_col_types = FALSE), silent = TRUE)
    if (inherits(x, "try-error") || !("Date" %in% names(x))) {
      x <- readr::read_csv(path, skip = 3, show_col_types = FALSE)
    }
    val_col <- setdiff(names(x), "Date")[1]   # first non-Date column is the value (e.g., "Venice")
    if (is.na(val_col)) stop(sprintf("No value column found in %s", path))
    dplyr::transmute(
      x,
      Date = suppressWarnings(lubridate::as_date(Date)),
      Date = dplyr::coalesce(Date, suppressWarnings(lubridate::my(x$Date))),
      Value = as.numeric(gsub("[^0-9.]", "", as.character(.data[[val_col]])))
    ) |>
      tidyr::drop_na(Date)
  }

  # ---------- 2.1 $/SqFt (trend-only; printed here) ----------
  psf_df <- all_medians %>%
    dplyr::filter(
      Metric == "per_sqft",
      Series == SeriesName,
      Segment %in% c("sfr","condo","multifamily")
    ) %>%
    dplyr::mutate(Type = label_type(Segment))

  p_psf <- ggplot2::ggplot(psf_df, ggplot2::aes(Date, Value, color = Type)) +
    ggplot2::geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
    ggplot2::scale_y_continuous(labels = scales::comma, breaks = scales::pretty_breaks(10)) +
    ggplot2::labs(title = "$ per SqFt — Venice", x = NULL, y = "$/SqFt") +
    ggplot2::guides(color = ggplot2::guide_legend(title = NULL)) +
    ggplot2::theme(
      legend.position = "top",
      legend.direction = "horizontal",
      legend.box = "horizontal"
    )

  # ---------- 2.2 Volume of Closed Sales (read from medians subfolders) ----------
  base_abs <- "C:/Users/stange/Desktop/DTR/code/Venice/venice"

  vol_con_path <- find_first(c(
    file.path("medians","condo","sold_volume_condo.csv"),
    file.path(base_abs,"medians","condo","sold_volume_condo.csv")
  ))
  vol_sfr_path <- find_first(c(
    file.path("medians","sfr","sold_volume_sfr.csv"),
    file.path(base_abs,"medians","sfr","sold_volume_sfr.csv")
  ))
  vol_inc_path <- find_first(c(
    file.path("medians","income","sold_volume_income.csv"),
    file.path(base_abs,"medians","income","sold_volume_income.csv")
  ))

  cnt_con_path <- find_first(c(
    file.path("medians","condo","closed_condo.csv"),
    file.path(base_abs,"medians","condo","closed_condo.csv")
  ))
  cnt_sfr_path <- find_first(c(
    file.path("medians","sfr","closed_sfr.csv"),
    file.path(base_abs,"medians","sfr","closed_sfr.csv")
  ))
  cnt_inc_path <- find_first(c(
    file.path("medians","income","closed_income.csv"),
    file.path(base_abs,"medians","income","closed_income.csv")
  ))

  # Read and tag
  vol_condo  <- read_metric_csv(vol_con_path) |> dplyr::mutate(Type = "Condo")
  vol_sfr    <- read_metric_csv(vol_sfr_path) |> dplyr::mutate(Type = "SFR")
  vol_income <- read_metric_csv(vol_inc_path) |> dplyr::mutate(Type = "Multifamily")

  cnt_condo  <- read_metric_csv(cnt_con_path) |> dplyr::mutate(Type = "Condo")
  cnt_sfr    <- read_metric_csv(cnt_sfr_path) |> dplyr::mutate(Type = "SFR")
  cnt_income <- read_metric_csv(cnt_inc_path) |> dplyr::mutate(Type = "Multifamily")

  # ----- build 6-month sequence and restrict data to those months -----
  month_min <- min(
    vol_condo$Date, vol_sfr$Date, vol_income$Date,
    cnt_condo$Date, cnt_sfr$Date, cnt_income$Date,
    na.rm = TRUE
  )
  month_max <- max(
    vol_condo$Date, vol_sfr$Date, vol_income$Date,
    cnt_condo$Date, cnt_sfr$Date, cnt_income$Date,
    na.rm = TRUE
  )

  # Full month grid
  month_seq_all <- seq(lubridate::floor_date(month_min, "month"),
                       lubridate::floor_date(month_max, "month"),
                       by = "month")
  month_levels_all <- format(month_seq_all, "%Y-%m")

  # Keep ONLY every 6th month as plotting points
  six_levels <- month_levels_all[seq(1, length(month_levels_all), by = 6)]

  # Aggregate & keep only 6-month rows
  volumes_all <- dplyr::bind_rows(vol_condo, vol_sfr, vol_income) %>%
    dplyr::mutate(
      MonthDate = lubridate::floor_date(Date, "month"),
      MonthLab  = format(MonthDate, "%Y-%m")
    ) %>%
    dplyr::filter(MonthLab %in% six_levels) %>%
    dplyr::group_by(Type, MonthLab) %>%
    dplyr::summarise(Value = sum(Value, na.rm = TRUE), .groups = "drop") %>%
    dplyr::mutate(MonthLab = factor(MonthLab, levels = six_levels))

  counts_all <- dplyr::bind_rows(cnt_condo, cnt_sfr, cnt_income) %>%
    dplyr::mutate(
      MonthDate = lubridate::floor_date(Date, "month"),
      MonthLab  = format(MonthDate, "%Y-%m")
    ) %>%
    dplyr::filter(MonthLab %in% six_levels) %>%
    dplyr::group_by(Type, MonthLab) %>%
    dplyr::summarise(Value = sum(Value, na.rm = TRUE), .groups = "drop") %>%
    dplyr::mutate(MonthLab = factor(MonthLab, levels = six_levels))

  # ----- plots: bars exist only at 6-month marks -----
  p_volume_dollars <- ggplot2::ggplot(volumes_all, ggplot2::aes(x = MonthLab, y = Value, fill = Type)) +
    ggplot2::geom_col(position = "dodge", width = 0.8) +
    ggplot2::scale_x_discrete(breaks = six_levels, drop = FALSE) +
    ggplot2::scale_y_continuous(labels = scales::dollar, breaks = scales::pretty_breaks(8)) +
    ggplot2::labs(
      title = "Closed Sales Volume ($) — 6-Month Points (SFR, Condo, Multifamily)",
      x = NULL, y = "Sold Volume (USD)"
    ) +
    ggplot2::guides(fill = ggplot2::guide_legend(title = NULL)) +
    ggplot2::theme(
      axis.text.x = ggplot2::element_text(angle = 45, hjust = 1),
      legend.position = "top",
      legend.direction = "horizontal",
      legend.box = "horizontal"
    )

  p_volume_counts <- ggplot2::ggplot(counts_all, ggplot2::aes(x = MonthLab, y = Value, fill = Type)) +
    ggplot2::geom_col(position = "dodge", width = 0.8) +
    ggplot2::scale_x_discrete(breaks = six_levels, drop = FALSE) +
    ggplot2::scale_y_continuous(labels = scales::comma, breaks = scales::pretty_breaks(8)) +
    ggplot2::labs(
      title = "Closed Sales (Count) — 6-Month Points (SFR, Condo, Multifamily)",
      x = NULL, y = "Closed Sales (count)"
    ) +
    ggplot2::guides(fill = ggplot2::guide_legend(title = NULL)) +
    ggplot2::theme(
      axis.text.x = ggplot2::element_text(angle = 45, hjust = 1),
      legend.position = "top",
      legend.direction = "horizontal",
      legend.box = "horizontal"
    )

  # -------- print only psf here --------
  p_psf
})

```

Above we can see the $/sqft graph, again illustrating the 5 year stagnation. as of August 2025, condos in Venice have a median price-per-sqft of $950/sqft,  SFRs go for a median of over $1,350/sqft, and multifamily homes, seeing a decline since mid 2023, stand at around $850/sqft.


<h2>Demand and Activity</h2>

<div class="columns-2">

<div>

```{r, echo=FALSE, out.width="100%"}
if (!is.null(p_volume_dollars)) p_volume_dollars
```
</div> <div>
```{r, echo=FALSE, out.width="100%"}  
if (!is.null(p_volume_counts)) p_volume_counts

```
</div> </div>


The above two charts show market volume, by dollar amount and sale count.
From the above two charts we can see that the market is dominated by single family homes. While there was a dip in activity in 2023, the market began to pick up again in mid 2024.

```{r}
# Build p_dom: Days on Market time series by property type (no print in this chunk)
suppressWarnings({
  if (!exists("SeriesName")) SeriesName <- "Venice"
  if (!exists("label_type")) {
    label_type <- function(seg) dplyr::case_when(
      tolower(seg) == "sfr"         ~ "SFR",
      tolower(seg) == "condo"       ~ "Condo",
      tolower(seg) == "multifamily" ~ "Multifamily",
      TRUE                          ~ seg
    )
  }

  dom_df <- all_medians %>%
    dplyr::mutate(
      Metric = dplyr::case_when(
        Metric %in% c("dom","median_dom","domsfr","dom_condo","dom_income") ~ "dom",
        TRUE ~ Metric
      )
    ) %>%
    dplyr::filter(
      Metric == "dom",
      Series == SeriesName,
      Segment %in% c("sfr","condo","multifamily")
    ) %>%
    dplyr::mutate(Type = label_type(Segment), Value = as.numeric(Value)) %>%
    dplyr::select(Date, Type, Value) %>%
    tidyr::drop_na(Date, Value)

  p_dom <- ggplot2::ggplot(dom_df, ggplot2::aes(Date, Value, color = Type)) +
    ggplot2::geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
    ggplot2::scale_y_continuous(breaks = scales::pretty_breaks(8)) +
    ggplot2::labs(title = "Days on Market — Venice", x = NULL, y = "Days") +
    ggplot2::guides(color = ggplot2::guide_legend(title = NULL)) +
    ggplot2::theme(
      legend.position = "top",
      legend.direction = "horizontal",
      legend.box = "horizontal"
    )
})

# Print once
p_dom
```

The above graph, showing median days-on-market by asset type, is a good indicator of demand. The longer it takes to sell a home - the lower the demand, and the more power buyers have. In the case of Venice, we can observe a small rise in median DOM during 2024, and a small decline in 2025, signifying a moderate market with increased demand. Coupled with the increase in market activity from the previous section, market power appears to be shifting towards sellers. 

<h3>Map: Price Pin Map</h3>
```{r maps}
# === clean sales data for Venice ===
suppressPackageStartupMessages({
  library(dplyr); library(leaflet); library(leaflet.extras); library(scales); library(htmltools)
})

# Fan overlapping points
fan_points <- function(df, offset = 0.0003) {
  if (nrow(df) == 0) return(df)
  df %>%
    group_by(latitude, longitude) %>%
    mutate(
      index = dplyr::row_number(),
      total = dplyr::n(),
      angle = 2 * pi * (index - 1) / pmax(total, 1),
      jitter_lat = latitude  + offset * sin(angle),
      jitter_lon = longitude + offset * cos(angle)
    ) %>% ungroup()
}

# Compact HTML size legend
make_size_legend <- function(counts = c(1, 5, 15), title = "Pin size = # of sales") {
  r <- pmin(14, log(counts + 1) * 5)
  items <- paste0(
    '<div style="display:flex;align-items:center;margin:4px 0">',
    '<div style="width:', 2*r, 'px;height:', 2*r, 'px;border-radius:50%;border:1px solid #000;margin-right:8px;"></div>',
    '<span>', counts, '</span>',
    '</div>',
    collapse = ""
  )
  paste0(
    '<div style="background:white;padding:8px 10px;border:1px solid #999;border-radius:6px;',
    'box-shadow:0 1px 4px rgba(0,0,0,.2);font-size:12px;max-width:180px;max-height:160px;overflow:auto">',
    '<div style="font-weight:600;margin-bottom:4px;">', title, '</div>',
    items,
    '</div>'
  )
}

size_legend_pos <- "topright"

# ---------------------------------------------------------------
# 1) Price pins (all property types, expanded bins)
# ---------------------------------------------------------------
price_bins <- sales_data %>%
  filter(!is.na(SP)) %>%
  mutate(price_range = cut(
    SP,
    breaks = c(0, 700000, 1000000, 2000000, 3000000, Inf),
    labels = c("Under $700K", "$700K–$1M", "$1M–$2M", "$2M–$3M", "Over $3M"),
    include.lowest = TRUE
  )) %>%
  filter(!is.na(price_range)) %>%
  group_by(latitude, longitude, price_range) %>%
  summarise(count = n(), avg_price = mean(SP, na.rm = TRUE), .groups = "drop") %>%
  fan_points()

pal_price <- colorFactor(
  palette = c("blue", "green", "orange", "purple", "red"),
  domain  = c("Under $700K", "$700K–$1M", "$1M–$2M", "$2M–$3M", "Over $3M"),
  na.color = "transparent"
)

price_pin_map <- leaflet(price_bins, width = "100%", height = 620) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(
    lng = ~jitter_lon, lat = ~jitter_lat,
    radius = ~pmin(14, log(count + 1) * 5),
    color = "black",
    fillColor = ~pal_price(price_range),
    fillOpacity = 0.85, weight = 1,
    label = ~paste0(count, " sale(s) in ", price_range),
    popup = ~paste0(
      "<b>Sales in this range:</b> ", count, "<br>",
      "<b>Price Range:</b> ", price_range, "<br>",
      "<b>Avg Price:</b> $", format(round(avg_price), big.mark = ",")
    )
  ) %>%
  addLegend("bottomright", pal = pal_price, values = ~price_range, title = "Price Range") %>%
  addControl(html = HTML(make_size_legend(c(1, 5, 15))), position = size_legend_pos)

# ---------------------------------------------------------------
# 2) DOM heatmap (all property types)
# ---------------------------------------------------------------
if (any(!is.na(sales_data$DOM))) {
  dom_heat_data <- sales_data %>% filter(!is.na(DOM) & is.finite(DOM))
  rng <- range(dom_heat_data$DOM, na.rm = TRUE)

  dom_heat_data <- dom_heat_data %>%
    mutate(dom_intensity = if (diff(rng) > 0) {
      (max(DOM, na.rm = TRUE) - DOM) / diff(rng)
    } else 0.5)

  dom_heat_map <- leaflet(dom_heat_data, width = "100%", height = 620) %>%
    addProviderTiles(providers$CartoDB.Positron) %>%
    addHeatmap(
      lng = ~longitude, lat = ~latitude, intensity = ~dom_intensity,
      blur = 24, radius = 20, max = 1, minOpacity = 0.5,
      gradient = c("0.00"="blue","0.50"="orange","1.00"="red")
    )

  qs <- quantile(dom_heat_data$DOM, probs = c(0.25, 0.50, 0.75), na.rm = TRUE)
  dom_heat_map <- dom_heat_map %>%
    addLegend("bottomright",
              colors = c("red","orange","blue"),
              labels = c(
                paste0("Fast (≤ ", round(qs[1]), " days)"),
                paste0("Moderate (", round(qs[1] + 1), "–", round(qs[3]), " days)"),
                paste0("Slow (≥ ", round(qs[3]), " days)")
              ),
              title = "DOM (lower = hotter)", opacity = 0.9)
}

# ---------------------------------------------------------------
# 3) Segment pins (Condo, SFR, Income)
# ---------------------------------------------------------------
seg_bins <- sales_data %>%
  filter(!is.na(latitude), !is.na(longitude)) %>%
  mutate(Segment = case_when(
    grepl("condo", Segment, ignore.case = TRUE) ~ "Condo",
    grepl("sfr|single", Segment, ignore.case = TRUE) ~ "SFR",
    grepl("income|multi|plex|apartment", Segment, ignore.case = TRUE) ~ "Income",
    TRUE ~ Segment
  )) %>%
  group_by(latitude, longitude, Segment) %>%
  summarise(count = n(), avg_price = mean(SP, na.rm = TRUE), .groups = "drop") %>%
  fan_points()

# --- Define palette including all three ---
pal_seg <- colorFactor(
  palette = c("Condo" = "#1f77b4", "SFR" = "#d62728", "Income" = "#2ca02c"),
  domain  = c("Condo", "SFR", "Income"),
  na.color = "transparent"
)

# --- Build segment map ---
seg_pin_map <- leaflet(seg_bins, width = "100%", height = 620) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addCircleMarkers(
    lng = ~jitter_lon, lat = ~jitter_lat,
    radius = ~pmin(14, log(count + 1) * 5),
    color = "black",
    fillColor = ~pal_seg(Segment),
    fillOpacity = 0.85, weight = 1,
    label = ~paste0(Segment, ": ", count, " sale(s)"),
    popup = ~paste0(
      "<b>Segment:</b> ", Segment, "<br>",
      "<b>Sales at this location:</b> ", count, "<br>",
      "<b>Avg Price:</b> $", format(round(avg_price), big.mark = ",")
    )
  ) %>%
  addLegend("bottomright", pal = pal_seg, values = ~Segment, title = "Segment") %>%
  addControl(html = HTML(make_size_legend(c(1, 5, 15))), position = size_legend_pos)

# --- Print in order ---
price_pin_map

```

The above map shows sales in the last 2 year by price point and location. As can be expected, concentration of high value sales can be observed in the Venice Canals, but we can also observe some high value sales around Penmar, and East of Lincoln/North of Venice blvd (especially on Palms blvd).


<h3>Heatmap: Days-On-Market</h3>
```{r}
dom_heat_map

```

<h3>Map: Asset Type Pin Map</h3>
```{r}
seg_pin_map
```


The above pin map shows sales by asset type around Venice. We can observe that single family homes are over represented east of Lincoln, whereas multifamily units dominate closer to the ocean. Condos are somewhat sprinkled around, but are more prevalent west of Lincoln. 

The heatmap shows locations with quick sale activity - the redder the mark, the faster it sells.


<h2> Rental Market Overview</h3>

```{r lease_section, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
# Rental Market Analysis — Venice
# ---- Paths ----
med_dir  <- "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians"
lease_ts_path     <- file.path(med_dir, "lease",  "lease.csv")
condo_lease_path  <- file.path(med_dir, "lease",  "condo_lease.csv")
sfr_lease_path    <- file.path(med_dir, "lease",  "sfr_lease.csv")
condo_price_path  <- file.path(med_dir, "condo",  "median_sale_condo.csv")
sfr_price_path    <- file.path(med_dir, "sfr",    "median_sale_sfr.csv")
income_price_path <- file.path(med_dir, "income", "median_sale_income.csv")   # NEW

# ---- Keep readers quiet (no deprecated tigris calls) ----
suppressWarnings({
  options(readr.show_progress = FALSE)
  options(tigris_use_cache = TRUE)  # harmless if tigris not loaded
  options(tigris_class = "sf")
})

# ---- Safe helper: capture & swallow printed output, return value or NULL on error ----
quiet_capture <- function(expr) {
  suppressMessages(suppressWarnings(
    tryCatch({
      utils::capture.output(res <- force(expr), file = NULL)
      res
    }, error = function(e) NULL)
  ))
}

# ---- Minimal helpers ----
parse_date <- function(x){
  d <- suppressWarnings(lubridate::my(x))
  i <- is.na(d); if (any(i)) d[i] <- suppressWarnings(lubridate::ymd(x[i]))
  i <- is.na(d); if (any(i)) d[i] <- suppressWarnings(lubridate::mdy(x[i]))
  as.Date(d)
}

read_median <- function(path){
  if (!file.exists(path)) return(tibble::tibble(Date=as.Date(character()), Value=double()))
  df <- suppressWarnings(tryCatch(readr::read_csv(path, show_col_types=FALSE, progress=FALSE), error=function(e) NULL))
  if (!is.null(df) && any(tolower(names(df))=="date")) {
    d <- names(df)[tolower(names(df))=="date"][1]
    v <- setdiff(names(df), d)[1]
    out <- tibble::tibble(
      Date  = parse_date(df[[d]]),
      Value = as.numeric(gsub("[^0-9.]", "", as.character(df[[v]])))
    )
  } else {
    df2 <- tryCatch(read.csv(path, stringsAsFactors=FALSE, skip=3), error=function(e) NULL)
    if (is.null(df2) || ncol(df2)<2) return(tibble::tibble(Date=as.Date(character()), Value=double()))
    out <- tibble::tibble(
      Date  = parse_date(df2[[1]]),
      Value = as.numeric(gsub("[^0-9.]", "", as.character(df2[[2]])))
    )
  }
  dplyr::filter(out, !is.na(Date), !is.na(Value))
}

# ---- 1) Median lease price over time ----
lease_ts <- read_median(lease_ts_path) %>%
  dplyr::filter(dplyr::between(Value, 300, 30000)) %>%
  dplyr::arrange(Date)

p_lease_trend <- if (nrow(lease_ts)) {
  ggplot2::ggplot(lease_ts, ggplot2::aes(Date, Value)) +
    ggplot2::geom_line() +
    ggplot2::geom_smooth(method="loess", se=FALSE, linetype="dashed") +
    ggplot2::scale_y_continuous(labels=scales::dollar_format(), breaks=scales::pretty_breaks(8)) +
    ggplot2::labs(title="Median Lease Price — Trend (Venice)", x=NULL, y="Monthly Rent (USD)")
} else NULL

# ---- 2) Bedroom bars ----
make_bed_bars <- function(path, title_prefix){
  if (!file.exists(path)) return(NULL)
  df <- readr::read_csv(path, show_col_types=FALSE, progress=FALSE)
  stopifnot(all(c("SP","BR") %in% names(df)))
  agg <- df %>%
    dplyr::mutate(
      Rent = as.numeric(gsub("[^0-9.]", "", as.character(.data[["SP"]]))),
      Beds = suppressWarnings(as.numeric(.data[["BR"]])),
      Bed  = dplyr::case_when(
        is.na(Beds) ~ NA_character_,
        Beds <= 0   ~ "Studio",
        Beds == 1   ~ "1BR",
        Beds == 2   ~ "2BR",
        Beds == 3   ~ "3BR",
        Beds == 4   ~ "4BR",
        Beds >= 5   ~ "5BR"
      )
    ) %>%
    dplyr::filter(!is.na(Bed), !is.na(Rent), dplyr::between(Rent, 300, 30000)) %>%
    dplyr::group_by(Bed) %>%
    dplyr::summarise(MedianRent = median(Rent, na.rm=TRUE), .groups="drop") %>%
    dplyr::mutate(Bed = factor(Bed, levels=c("Studio","1BR","2BR","3BR","4BR","5BR"))) %>%
    dplyr::arrange(Bed)

  if (!nrow(agg)) return(NULL)
  ggplot2::ggplot(agg, ggplot2::aes(Bed, MedianRent)) +
    ggplot2::geom_col() +
    ggplot2::scale_y_continuous(labels=scales::dollar_format(), breaks=scales::pretty_breaks(8)) +
    ggplot2::labs(title=paste0(title_prefix, " — Median Lease by Bedroom (All Leases)"),
                  x=NULL, y="Monthly Rent (USD)")
}

p_condo_beds <- make_bed_bars(condo_lease_path, "Condo")
p_sfr_beds   <- make_bed_bars(sfr_lease_path,   "SFR")

# ---- 3) Price-to-Rent ratio (sale median / lease median) ----
condo_price  <- read_median(condo_price_path)  %>% dplyr::mutate(Segment="Condo")
sfr_price    <- read_median(sfr_price_path)    %>% dplyr::mutate(Segment="SFR")
income_price <- read_median(income_price_path) %>% dplyr::mutate(Segment="Income")   # NEW

price_ts <- dplyr::bind_rows(condo_price, sfr_price, income_price) %>%
  dplyr::rename(Price=Value) %>%
  dplyr::filter(!is.na(Price)) %>%
  dplyr::arrange(Date)

ratio_df <- price_ts %>%
  dplyr::inner_join(lease_ts %>% dplyr::rename(Rent=Value), by="Date") %>%
  dplyr::filter(Rent>0, Price>0) %>%
  dplyr::mutate(Type=paste0(Segment," ÷ Lease"), Ratio=Price / Rent)

p_ratio <- if (nrow(ratio_df)) {
  ggplot2::ggplot(ratio_df, ggplot2::aes(Date, Ratio, color=Type)) +
    ggplot2::geom_smooth(method="loess", se=FALSE, linetype="dashed") +
    ggplot2::scale_y_continuous(breaks=scales::pretty_breaks(8)) +
    ggplot2::labs(title="Price-to-Rent Ratio — Venice",
                  subtitle = "Median Sale / Median Lease",
                  x=NULL, y="Price / Rent Ratio") +
    ggplot2::guides(color=ggplot2::guide_legend(title=NULL))
} else NULL

# ---- 4) Rental Vacancy Rate (ACS 5-year) — Venice boundary ----
census_api_key("9d5931816199a62a9bbf24d1fb859fe15fd9ba6c", install = FALSE)
years <- 2019:2023

fetch_vr <- function(y) {
  suppressPackageStartupMessages({
    library(sf); library(dplyr); library(tidyr); library(tidycensus)
  })

  # 1) LA Times neighborhood polygons → filter Venice
  ven_all <- quiet_capture(sf::read_sf(
    "https://services5.arcgis.com/7nsPwEMP38bSkCjy/arcgis/rest/services/LA_Times_Neighborhoods/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=geojson"
  ))
  if (is.null(ven_all)) stop("Could not load LA Times neighborhood boundary layer.")

  name_candidates <- intersect(names(ven_all), c("NAME","Name","name","neighborhood","Neighborhood"))
  if (length(name_candidates) == 0) stop("No name field found in boundary layer.")
  ncol <- name_candidates[1]
  venice <- dplyr::filter(ven_all, grepl("^venice$", .data[[ncol]], ignore.case = TRUE))
  if (nrow(venice) == 0) stop("Venice polygon not found in boundary layer.")

  # 2) ACS block groups (quietly)
  acs_bg <- quiet_capture(tidycensus::get_acs(
    geography = "block group",
    state = "CA",
    county = "Los Angeles",
    survey = "acs5",
    year = y,
    variables = c(
      vac_units  = "B25004_003", # Rented, not occupied
      renter_occ = "B25003_003"  # Renter-occupied
    ),
    geometry = TRUE,
    output   = "wide"
  ))
  if (is.null(acs_bg)) stop("ACS download failed.")

  acs_bg <- acs_bg %>%
    dplyr::rename(
      estimate_vac_units   = vac_unitsE,
      moe_vac_units        = vac_unitsM,
      estimate_renter_occ  = renter_occE,
      moe_renter_occ       = renter_occM
    )

  # 3) Area-weight into Venice boundary
  venice_eq <- sf::st_transform(venice, 3857)
  bgs_eq    <- sf::st_transform(acs_bg, 3857)
  bgs_eq    <- bgs_eq[sf::st_intersects(bgs_eq, venice_eq, sparse = FALSE), ]

  pieces <- quiet_capture(sf::st_intersection(
    dplyr::select(bgs_eq,
                  GEOID,
                  estimate_vac_units, moe_vac_units,
                  estimate_renter_occ, moe_renter_occ,
                  geometry),
    dplyr::select(venice_eq, geometry)
  ))
  if (is.null(pieces) || nrow(pieces) == 0) stop("Geometry intersection produced no pieces.")

  area_bg <- setNames(as.numeric(sf::st_area(bgs_eq)), bgs_eq$GEOID)
  pieces <- pieces %>%
    dplyr::mutate(
      area_piece = as.numeric(sf::st_area(geometry)),
      area_bg    = area_bg[GEOID],
      w          = pmin(pmax(area_piece / area_bg, 0), 1),
      est_num    = estimate_vac_units   * w,
      moe_num    = moe_vac_units        * w,
      est_rent   = estimate_renter_occ  * w,
      moe_rent   = moe_renter_occ       * w
    )

  totals <- pieces %>%
    sf::st_drop_geometry() %>%
    dplyr::summarise(
      num        = sum(est_num,  na.rm = TRUE),
      num_moe    = tidycensus::moe_sum(moe_num),
      renter     = sum(est_rent, na.rm = TRUE),
      renter_moe = tidycensus::moe_sum(moe_rent)
    ) %>%
    dplyr::mutate(
      den         = renter + num,
      den_moe     = tidycensus::moe_sum(c(renter_moe, num_moe)),
      vacancy     = dplyr::if_else(den > 0, num / den, NA_real_),
      vacancy_moe = dplyr::if_else(den > 0,
                        tidycensus::moe_prop(num, den, num_moe, den_moe),
                        NA_real_),
      Year        = y
    ) %>%
    dplyr::select(Year, num, num_moe, den, den_moe, vacancy, vacancy_moe)

  totals
}

vac_5yr <- dplyr::bind_rows(lapply(years, fetch_vr)) %>%
  dplyr::arrange(Year)

p_vac <- ggplot2::ggplot(vac_5yr, ggplot2::aes(x = Year, y = vacancy)) +
  ggplot2::geom_line() +
  ggplot2::geom_point(size = 2) +
  ggplot2::scale_x_continuous(breaks = years) +
  ggplot2::scale_y_continuous(labels = scales::percent_format(accuracy = 0.1)) +
  ggplot2::labs(
    title    = "Rental Vacancy Rate — Venice (ACS 5-year)",
    subtitle = "Area-weighted from LA County block groups: Vacant-for-Rent / (Renter-Occupied + Vacant-for-Rent)",
    x = NULL, y = "Vacancy Rate"
  )

# ---- Print only the lease trend here (keep others for later) ----
if (inherits(p_lease_trend, "ggplot")) p_lease_trend

```


Median lease prices in Venice have also been stagnating a bit. While they continuously rise, they do so at a declining rate, almost flattening at around $5,600 in July 2025.


<div class="columns-2">

<div>
```{r}
if (inherits(p_condo_beds,  "ggplot"))
p_condo_beds

```
</div><div>

```{r}
if (inherits(p_sfr_beds,    "ggplot"))
p_sfr_beds
```
</div></div>





The above 2 charts show the median lease price for various unit sizes, for condos and SFRs. The jump in prices at the highest bedroom count can be partly attributed to the low quantity of such units, rather than size.


<div class="columns-2">

<div>
```{r}
if (inherits(p_ratio,       "ggplot"))
p_ratio

```
</div><div>

```{r}
if (inherits(p_vac,         "ggplot"))
p_vac
```
</div></div>


The above two graphs are ratio signals of the rental market from an owner's perspective. The higher a price/rent ratio is, the higher the price of a property relative to lease price. While all property types saw a dip in price/rent ratio during 2024, SFRs and multifamily homes saw a sharp increase towards the end of 2024. Condos rose at a slow pace. 

Vacancy rate, signaling how easy it is to find tenants, is quite low in Venice, just baerly surpassing the 1% line. This is evidence that rental units in Venice are in high demand. 


<h2>Market Composition and Demographics</h2>

```{r mdr_acs_summary_updated, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, results='hide'}

suppressPackageStartupMessages({
  library(dplyr); library(tidyr); library(ggplot2); library(scales)
  library(sf); library(tidycensus); library(stringr)
})

# ---- swallow stdout/stderr from noisy calls ----
quiet_capture <- function(expr) {
  suppressMessages(suppressWarnings(
    tryCatch({
      utils::capture.output({ res <- force(expr) }, type = "output")
      utils::capture.output({ res }, type = "message")
      res
    }, error = function(e) NULL)
  ))
}

yr <- 2023
years <- (yr - 9):yr

# --- 0) Venice neighborhood boundary from LA Times layer (quiet) ---
ven_all <- quiet_capture(
  sf::read_sf(
    "https://services5.arcgis.com/7nsPwEMP38bSkCjy/arcgis/rest/services/LA_Times_Neighborhoods/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=geojson"
  )
)
stopifnot(!is.null(ven_all))

name_candidates <- intersect(names(ven_all), c("NAME","Name","name","neighborhood","Neighborhood"))
stopifnot(length(name_candidates) > 0)
nmcol <- name_candidates[1]
venice <- dplyr::filter(ven_all, str_to_lower(.data[[nmcol]]) == "venice")
stopifnot(nrow(venice) > 0)

# Transform to an equal-area proj for reliable area weights
venice_eq <- st_transform(venice, 3857)

# --- Helper: area-weight ACS counts into Venice (quiet intersections) ---
area_weight_counts <- function(acs_gdf, cols) {
  bgs_eq <- st_transform(acs_gdf, 3857)
  bgs_eq <- bgs_eq[st_intersects(bgs_eq, venice_eq, sparse = FALSE), ]
  if (!nrow(bgs_eq)) return(setNames(rep(NA_real_, length(cols)), cols))

  pieces <- quiet_capture(st_intersection(
    dplyr::select(bgs_eq, GEOID, dplyr::all_of(cols), geometry),
    dplyr::select(venice_eq, geometry)
  ))
  if (is.null(pieces) || !nrow(pieces)) return(setNames(rep(NA_real_, length(cols)), cols))

  area_bg <- setNames(as.numeric(st_area(bgs_eq)), bgs_eq$GEOID)

  pieces |>
    mutate(
      area_piece = as.numeric(st_area(geometry)),
      area_bg    = area_bg[GEOID],
      w          = pmin(pmax(area_piece / area_bg, 0), 1)
    ) |>
    st_drop_geometry() |>
    reframe(dplyr::across(dplyr::all_of(cols), ~ sum(.x * w, na.rm = TRUE)))
}

# --- 1) Income over time (household-weighted mean of medians) ---
safe_income_year <- function(y) {
  acs <- quiet_capture(
    tidycensus::get_acs(
      geography = "block group",
      state = "CA",
      county = "Los Angeles",
      survey = "acs5",
      year = y,
      variables = c(median_income = "B19013_001", households = "B11001_001"),
      geometry = TRUE,
      output = "wide"
    )
  )
  if (is.null(acs) || !nrow(acs)) return(tibble(Year = y, Income = NA_real_))

  acs <- acs %>% rename(medianE = median_incomeE, hhE = householdsE)

  hh_tot <- area_weight_counts(acs, "hhE") %>% as.numeric()
  if (is.na(hh_tot) || hh_tot <= 0) return(tibble(Year = y, Income = NA_real_))

  bgs_eq <- st_transform(acs, 3857)
  bgs_eq <- bgs_eq[st_intersects(bgs_eq, venice_eq, sparse = FALSE), ]
  pieces <- quiet_capture(st_intersection(
    dplyr::select(bgs_eq, GEOID, medianE, hhE, geometry),
    dplyr::select(venice_eq, geometry)
  ))
  if (is.null(pieces) || !nrow(pieces)) return(tibble(Year = y, Income = NA_real_))

  area_bg <- setNames(as.numeric(st_area(st_transform(acs, 3857))), acs$GEOID)

  wm <- pieces |>
    mutate(
      area_piece = as.numeric(st_area(geometry)),
      area_bg    = area_bg[GEOID],
      w          = pmin(pmax(area_piece / area_bg, 0), 1),
      hh_piece   = hhE * w
    ) |>
    st_drop_geometry() |>
    summarise(
      num = sum(medianE * pmax(hh_piece, 0), na.rm = TRUE),
      den = sum(pmax(hh_piece, 0), na.rm = TRUE)
    )

  tibble(Year = y, Income = if (wm$den > 0) as.numeric(wm$num / wm$den) else NA_real_)
}

income_ts <- bind_rows(lapply(years, safe_income_year)) |> arrange(Year)

p_income_ts <- ggplot(income_ts, aes(Year, Income)) +
  geom_line() + geom_point(size = 2) +
  geom_smooth(method = "loess", se = FALSE, linetype = "dashed") +
  scale_x_continuous(breaks = years) +
  scale_y_continuous(labels = dollar_format()) +
  labs(
    title = "Median Household Income (approx.) — Venice neighborhood",
    subtitle = "Household-weighted mean of block-group medians (ACS 5-year)",
    x = NULL, y = "USD"
  )

# --- 2) Tenure (Owner vs Renter) within Venice ---
tenure_counts <- function(y) {
  acs <- quiet_capture(
    tidycensus::get_acs(
      geography = "block group",
      state = "CA",
      county = "Los Angeles",
      survey = "acs5",
      year = y,
      variables = c(owner = "B25003_002", renter = "B25003_003"),
      geometry = TRUE,
      output = "wide"
    )
  )
  if (is.null(acs) || !nrow(acs)) return(tibble(owner = NA_real_, renter = NA_real_))
  acs <- acs %>% rename(ownerE = ownerE, renterE = renterE)
  area_weight_counts(acs, c("ownerE","renterE")) %>% as_tibble() %>%
    rename(owner = ownerE, renter = renterE)
}

ten <- tenure_counts(yr)
ten$total <- sum(ten$owner, ten$renter, na.rm = TRUE)

tenure <- tibble(
  Type  = c("Owner-occupied","Renter-occupied"),
  Rate  = if (!is.na(ten$total) && ten$total > 0) c(ten$owner, ten$renter) / ten$total else c(NA_real_, NA_real_)
)

p_tenure <- ggplot(tenure, aes(Type, Rate, fill = Type)) +
  geom_col() +
  scale_y_continuous(labels = percent_format(accuracy = 0.1), limits = c(0,1)) +
  labs(
    title = paste0("Tenure — Owner vs Renter (ACS 5-year ", yr, ") — Venice neighborhood"),
    x = NULL, y = "Share of Occupied Housing Units"
  ) +
  guides(fill = "none")

# --- 3) Owner-occupied by age of householder (8 bins) within Venice ---
owner_age_vars <- paste0("B25007_", sprintf("%03d", 2:10))

owner_age_counts <- function(y) {
  acs <- quiet_capture(
    tidycensus::get_acs(
      geography = "block group",
      state = "CA",
      county = "Los Angeles",
      survey = "acs5",
      year = y,
      variables = owner_age_vars,
      geometry = TRUE,
      output = "wide"
    )
  )
  if (is.null(acs) || !nrow(acs)) return(tibble(Age = factor(character()), Households = double()))

  est_cols <- paste0(owner_age_vars, "E")
  aw <- area_weight_counts(acs, est_cols)
  if (all(is.na(aw))) return(tibble(Age = factor(character()), Households = double()))

  long <- tibble(variable = est_cols, Households = as.numeric(aw[1, est_cols]))
  age_map <- tibble(
    variable = est_cols,
    Age = factor(
      c("15–24","25–34","35–44","45–54","55–59","60–64","65–74","75–84","85+"),
      levels = c("15–24","25–34","35–44","45–54","55–59","60–64","65–74","75–84","85+")
    )
  )
  long %>% inner_join(age_map, by = "variable") %>% select(Age, Households)
}

oa_raw <- owner_age_counts(yr)

owner_age_display <- oa_raw %>%
  mutate(Age = as.character(Age)) %>%
  mutate(Age = recode(Age, "55–59" = "55–64", "60–64" = "55–64")) %>%
  group_by(Age) %>%
  summarise(Households = sum(Households, na.rm = TRUE), .groups = "drop") %>%
  mutate(
    Total = sum(Households, na.rm = TRUE),
    Share = if_else(Total > 0, Households / Total, NA_real_)
  ) %>%
  mutate(Age = factor(Age, levels = c("15–24","25–34","35–44","45–54","55–64","65–74","75–84","85+"))) %>%
  arrange(Age)

p_owner_age <- ggplot(owner_age_display, aes(Age, Share, fill = Age)) +
  geom_col() +
  scale_y_continuous(labels = percent_format(accuracy = 0.1), limits = c(0,1)) +
  labs(
    title = paste0("Owner-Occupied Households by Age of Householder (ACS 5-year ", yr, ") — Venice neighborhood"),
    x = NULL, y = "Share of Owner-Occupied Households"
  ) +
  guides(fill = "none")



# ---- ZCTA age comparison (quiet get_acs) ----
zctas_venice <- c("90291")

age_bins <- list(
  "15-24" = c("B01001_006","B01001_007","B01001_008","B01001_009","B01001_010",
               "B01001_030","B01001_031","B01001_032","B01001_033","B01001_034"),
  "25-34" = c("B01001_011","B01001_012","B01001_035","B01001_036"),
  "35-44" = c("B01001_013","B01001_014","B01001_037","B01001_038"),
  "45-54" = c("B01001_015","B01001_016","B01001_039","B01001_040"),
  "55-64" = c("B01001_017","B01001_018","B01001_019","B01001_041","B01001_042","B01001_043"),
  "65-74" = c("B01001_020","B01001_021","B01001_022","B01001_044","B01001_045","B01001_046"),
  "75-84" = c("B01001_023","B01001_024","B01001_047","B01001_048"),
  "85+"   = c("B01001_025","B01001_049")
)

get_age_distribution_zcta <- function(year, zctas) {
  dat <- quiet_capture(
    tidycensus::get_acs(
      geography = "zcta",
      year = year,
      survey = "acs5",
      variables = paste0("B01001_", sprintf("%03d", 1:49))
    )
  )
  if (is.null(dat) || !nrow(dat)) return(tibble(age_group=character(), estimate=double(), year=character()))

  dat <- dat %>%
    filter(GEOID %in% zctas) %>%
    group_by(variable) %>%
    summarise(estimate = sum(estimate, na.rm = TRUE), .groups = "drop")

  bind_rows(lapply(names(age_bins), function(bin) {
    tibble(age_group = bin, estimate = sum(dat$estimate[dat$variable %in% age_bins[[bin]]], na.rm = TRUE))
  })) %>% mutate(year = as.character(year))
}

age2013 <- get_age_distribution_zcta(2013, zctas_venice)
age2023 <- get_age_distribution_zcta(2023, zctas_venice)

age_order <- c("15-24","25-34","35-44","45-54","55-64","65-74","75-84","85+")

age_combined <- bind_rows(age2013, age2023) %>%
  group_by(year) %>% mutate(share = estimate / sum(estimate)) %>% ungroup() %>%
  mutate(age_group = factor(age_group, levels = age_order))

stopifnot(nrow(age_combined) > 0, all(is.finite(age_combined$share)))

ggplot(age_combined, aes(x = age_group, y = share, fill = year)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.75) +
  scale_y_continuous(labels = percent_format(accuracy = 1)) +
  labs(
    title = "Age Distribution — Venice (ZCTA 90291), ACS 5-year",
    subtitle = "Comparing 2009–2013 vs 2019–2023",
    x = "Age Group",
    y = "Share of Population"
  ) +
  theme_minimal(base_size = 14)+
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )


```

The population of Venice has gotten a little older between 2013-2023. While not a radical change, age groups above 55 years old have grown quite significantly in the last decade. The lower percentage of residents under 24 years old might indicate that families are looking elsewhere. 

```{r}
p_income_ts
```

Median household income has been rising in the last decade, flattening at around $120,000, exceeding the county median at $87,760.



```{r}
# --- PRINT ---
p_tenure
```


The above graph shows the share of housing units that are rented vs owner-occupied. While most units in Venice are occupied by renters, a quite large portion of occupants own their home.

<h2>Development, Construction, and Permits</h2>
```{r permits_bar_from_files, echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
perm_dir <- "C:/Users/stange/Desktop/DTR/code/Venice/venice/medians/permits"

# list all csvs
files <- list.files(perm_dir, pattern = "\\.csv$", full.names = TRUE)

parse_one <- function(path) {
  base <- tolower(basename(path))
  # asset from filename
  asset <- if (grepl("apartment", base)) "Apartment" else
           if (grepl("commercial", base)) "Commercial" else
           if (grepl("residential", base)) "Residential" else NA_character_
  # status from filename
  status <- if (grepl("final", base)) "Finaled" else
            if (grepl("issued", base)) "Issued" else NA_character_
  # count rows = permits
  n_rows <- tryCatch(nrow(suppressWarnings(readr::read_csv(path, show_col_types = FALSE))),
                     error = function(e) NA_integer_)
  data.frame(Asset = asset, Status = status, Permits = n_rows, stringsAsFactors = FALSE)
}

df <- do.call(rbind, lapply(files, parse_one))
df <- df[!is.na(df$Asset) & !is.na(df$Status) & !is.na(df$Permits), , drop = FALSE]

# aggregate & fill missing combos with zeros
bar_df <- df |>
  dplyr::group_by(Asset, Status) |>
  dplyr::summarise(Permits = sum(Permits, na.rm = TRUE), .groups = "drop") |>
  tidyr::complete(
    Asset  = c("Apartment","Commercial","Residential"),
    Status = c("Issued","Finaled"),
    fill = list(Permits = 0)
  ) |>
  dplyr::mutate(
    Asset  = factor(Asset,  levels = c("Apartment","Commercial","Residential")),
    Status = factor(Status, levels = c("Issued","Finaled"))
  )

p <- ggplot2::ggplot(bar_df, ggplot2::aes(x = Asset, y = Permits, fill = Status)) +
  ggplot2::geom_col(position = ggplot2::position_dodge(width = 0.7), width = 0.6) +
  ggplot2::geom_text(ggplot2::aes(label = Permits),
                     position = ggplot2::position_dodge(width = 0.7),
                     vjust = -0.3, size = 3) +
  ggplot2::scale_y_continuous(expand = ggplot2::expansion(mult = c(0, 0.08))) +
  ggplot2::labs(
    title = "Permits by Asset Type and Status",
    x = NULL, y = "Number of Permits", fill = NULL
  )+
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )
# Build two bar charts from the raw CSV files (no date dependency):
# 1) Issued only: x = Asset (Apartment/Commercial/Residential), color = Action (New/Demolition)
# 2) Finaled only: same as above

perm_dir <- "C:/Users/stange/Desktop/DTR/code/mdr/mdr/medians/permits"
files <- list.files(perm_dir, pattern = "\\.csv$", full.names = TRUE)

parse_one <- function(path) {
  base <- tolower(basename(path))
  asset <- if (grepl("apartment",  base)) "Apartment"  else
           if (grepl("commercial", base)) "Commercial" else
           if (grepl("residential",base)) "Residential" else NA_character_
  action <- if (grepl("demo", base)) "Demolition" else
            if (grepl("new",  base)) "New"        else NA_character_
  status <- if (grepl("final",  base)) "Finaled" else
            if (grepl("issued", base)) "Issued"  else NA_character_
  n_rows <- tryCatch(nrow(suppressWarnings(readr::read_csv(path, show_col_types = FALSE))),
                     error = function(e) NA_integer_)
  data.frame(Asset = asset, Action = action, Status = status, Permits = n_rows, stringsAsFactors = FALSE)
}

df <- do.call(rbind, lapply(files, parse_one))
df <- df[!is.na(df$Asset) & !is.na(df$Action) & !is.na(df$Status) & !is.na(df$Permits), , drop = FALSE]

# Aggregate counts and fill missing combos with zeros
base_levels_asset  <- c("Apartment","Commercial","Residential")
base_levels_action <- c("New","Demolition")

agg <- df |>
  dplyr::group_by(Asset, Action, Status) |>
  dplyr::summarise(Permits = sum(Permits, na.rm = TRUE), .groups = "drop")

# ----- Chart 1: Issued only -----
issued_df <- agg |>
  dplyr::filter(Status == "Issued") |>
  tidyr::complete(
    Asset  = base_levels_asset,
    Action = base_levels_action,
    fill = list(Permits = 0)
  ) |>
  dplyr::mutate(
    Asset  = factor(Asset,  levels = base_levels_asset),
    Action = factor(Action, levels = base_levels_action)
  )

p_issued <- ggplot2::ggplot(issued_df, ggplot2::aes(x = Asset, y = Permits, fill = Action)) +
  ggplot2::geom_col(position = ggplot2::position_dodge(width = 0.7), width = 0.6) +
  ggplot2::geom_text(ggplot2::aes(label = Permits),
                     position = ggplot2::position_dodge(width = 0.7),
                     vjust = -0.3, size = 3) +
  ggplot2::scale_y_continuous(expand = ggplot2::expansion(mult = c(0, 0.08))) +
  ggplot2::labs(
    title = "Permits (Issued) — by Asset and Action",
    x = NULL, y = "Number of Permits", fill = NULL
  )+
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )
# ----- Chart 2: Finaled only -----
finaled_df <- agg |>
  dplyr::filter(Status == "Finaled") |>
  tidyr::complete(
    Asset  = base_levels_asset,
    Action = base_levels_action,
    fill = list(Permits = 0)
  ) |>
  dplyr::mutate(
    Asset  = factor(Asset,  levels = base_levels_asset),
    Action = factor(Action, levels = base_levels_action)
  )

p_finaled <- ggplot2::ggplot(finaled_df, ggplot2::aes(x = Asset, y = Permits, fill = Action)) +
  ggplot2::geom_col(position = ggplot2::position_dodge(width = 0.7), width = 0.6) +
  ggplot2::geom_text(ggplot2::aes(label = Permits),
                     position = ggplot2::position_dodge(width = 0.7),
                     vjust = -0.3, size = 3) +
  ggplot2::scale_y_continuous(expand = ggplot2::expansion(mult = c(0, 0.08))) +
  ggplot2::labs(
    title = "Permits (Finaled) — by Asset and Action",
    x = NULL, y = "Number of Permits", fill = NULL
  )+
  ggplot2::theme(
    legend.position = "top",
    legend.direction = "horizontal",
    legend.box = "horizontal"
  )

```

<div class="columns-3">

<div>

```{r}
p
```
</div><div>

```{r}
p_issued
```
</div><div>


```{r}
p_finaled
```
</div></div>




The above 3 graphs show show permit data from the last year. We can see most permits we residential, and many were finaled. Very interestingly, a lot of demolition permits were  finaled, and a lot of new construction permits were issued, all around the same time and with similar numbers. This indicates a strong developer confidence in the market. 



```{r}
# leases <- read_csv(
#   "C:/Users/stange/Desktop/DTR/code/Venice/venice/individual/venice-lease.csv",
#   show_col_types = FALSE
# )
# 
# # Helper: normalize address and strip unit/suite identifiers at the end
# norm_addr <- function(x) {
#   x %>%
#     str_to_lower() %>%                         # case-insensitive
#     str_replace_all(",", " ") %>%              # remove commas
#     str_squish() %>%                           # collapse extra spaces
#     # remove things like "#123", "apt 3b", "unit a", "suite 4", "ste c", "space 12", "no 5" at the END
#     str_replace("\\s+(?:#|unit|apt|apartment|suite|ste|space|spc|no\\.?|number)\\s*[-\\w]+\\s*$", "") %>%
#     str_squish()
# }
# 
# leases_clean <- leases %>%
#   mutate(
#     Address_clean = norm_addr(Address),
#     City_clean    = str_squish(str_to_lower(City))
#   )
# 
# top_buildings_lease <- leases_clean %>%
#   group_by(City_clean, Address_clean) %>%
#   summarise(LeaseCount = n(), .groups = "drop") %>%
#   arrange(desc(LeaseCount)) %>%
#   slice_head(n = 25)
# 
# print(top_buildings_lease)
```





<h3>Large Projects - Recently Approved</h3>

<ul>
<li>Venice Dell - A 120 affordable supportive housing development, facing a lot of setbacks</li>
<li>Venice Place - A boutique 78-room hotel, located on Abbot Kinney Boulevard</li>
<li>Division 6 - Redevelopment of the Metro Division 6 bus yard at 100 Sunset Avenue into a mixed-use site with both market-rate and affordable housing</li>
<li>Mixed-Use at 825 S. Hampton Drive- A residential-retail mixed-use complex proposed for Abbot Kinney just east of Main Street</li>
<li>50 Apartments over Retail at 1808 Lincoln Boulevard- Wiseman Residential’s mixed-use building combining retail on the ground floor with 50 apartments above</li>
</ul>




<h2>Conclusions:</h2>
<p>
Following a small peak and drop around late 2022-early 2023, prices of all property types in Venice are slowly rising, with condos rising the slowest.

Demand for Venice real estate has been rising in the last two years, as can be noted by the increased market activity and lower days on market before sale. Multi family properties in particular are seeing a sharp rise in demand. 

In the last 2 years, most real estate sales in Venice were above $1,000,000. Most expensive areas include the Canals, along the beach, and insulated, quiet neighborhoods with large lots.Most single family homes were sold east of Lincoln Blvd, whereas condos and multi-families are more common west of it.

The rental market in Venice has been fairly steady, with lease prices flattening at a median of around $5,600. Price-to-rent ratio, which compares lease prices to sale prices, have increased for multi-families and single family homes, which have seen a major dip in the last 3 years, implying sale prices increased faster than rental prices (condos have remained steady). Vacancy has been quite low in Venice, hovering around 1%, suggesting a strong demand for rentals.

The population of Venice has gotten older in the last decade, with people ages 55+ growing at a slightly faster rate than younger age groups. The median household income in Venice was estimated at around $115,000 in 2023, which makes it a very affluent neighborhood. Around two thirds of Venice houses are rented, whereas one third is owner-occupied.

Quite a few residential new construction permits were Issued in the last few years, and a lot of demolition permits were finaled, suggesting a period of development.

Overall, Venice is experiencing slow but steady growth, a strong but competitive rental market, and considerable development. 